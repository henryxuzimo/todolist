# 待办事项应用

一个简单、美观的本地待办事项管理程序，使用 HTML、CSS 和 JavaScript 构建。

## 功能特性

- ✅ 添加新任务（支持指定负责人，默认"子墨"）
- ✅ 设置任务截止日期
- ✅ 标记任务为已完成/未完成
- ✅ 删除任务
- ✅ 筛选任务（全部/待完成/已完成）
- ✅ 任务统计（总任务数、已完成数）
- ✅ 企业微信推送（支持推送到企业微信群）
- ✅ Webhook 配置（可自定义企业微信机器人地址）
- ✅ 数据持久化（优先使用本地文件，localStorage 作为备份）
- ✅ 响应式设计，适配不同屏幕尺寸
- ✅ 美观的现代化界面

## ⚠️ 重要提示：必须使用 HTTP 服务器运行

**由于浏览器安全限制（CORS 策略），企业微信推送功能需要通过代理服务器运行。**

**推荐使用一键启动脚本（最简单）：**

### Windows 用户：
1. **一键启动**：双击运行 `一键启动.bat` 文件
   - 自动启动所有服务
   - 自动打开浏览器
   - 服务器在后台运行，无需保持终端窗口打开

2. **停止服务**：双击运行 `停止服务.bat` 文件

### Mac/Linux 用户：
1. **一键启动**：运行 `bash 一键启动.sh`
   - 自动启动所有服务
   - 自动打开浏览器
   - 服务器在后台运行

2. **停止服务**：运行 `bash 停止服务.sh`

### 启动的服务：
1. **代理服务器**（端口 3001）- 用于转发企业微信 API 请求，解决 CORS 问题
2. **前端服务器**（端口 8000）- 用于运行应用

启动后，浏览器会自动打开并访问：**http://localhost:8000**

### 其他启动方式（高级用户）：
- `启动完整服务.bat` / `启动完整服务.sh` - 显示详细日志的启动方式

## 使用方法

### 基本操作

1. 在输入框中输入任务内容
2. 在负责人输入框中输入负责人（默认为"子墨"）
3. 选择截止日期（可选）
4. 点击"添加"按钮或按 Enter 键添加任务
5. 点击复选框标记任务为已完成
6. 点击删除按钮（🗑️）删除任务
7. 使用筛选按钮查看不同状态的任务

### 企业微信推送

1. **配置 Webhook 地址**：
   - 点击右上角的配置按钮（⚙️）
   - 输入企业微信机器人的 Webhook 地址
   - 点击"保存"

2. **推送任务**：
   - 在任务列表中，点击推送按钮（📤）
   - 在确认对话框中确认推送
   - 任务信息将发送到企业微信群

3. **批量推送**：
   - 点击左上角的推送按钮（📤）
   - 确认后，所有待办任务将依次推送到企业微信

### 获取企业微信 Webhook 地址

1. 在企业微信中创建一个群聊
2. 点击群聊右上角的"..." → "群机器人" → "添加机器人"
3. 设置机器人名称，完成后会显示 Webhook 地址
4. 复制 Webhook 地址到本应用的配置中

## 技术栈

- **HTML5**: 页面结构
- **CSS3**: 样式和动画效果
- **JavaScript (ES6+)**: 应用逻辑
- **File System Access API**: 本地文件存储
- **IndexedDB**: 文件句柄持久化
- **localStorage**: 数据备份存储
- **Node.js**: 代理服务器（解决 CORS 问题）

## 文件结构

```
待办/
├── index.html              # 主页面
├── styles.css              # 样式文件
├── app.js                  # 应用逻辑
├── proxy-server.js         # 企业微信 API 代理服务器
├── 一键启动.bat            # Windows 一键启动（推荐）
├── 一键启动.sh             # Linux/Mac 一键启动（推荐）
├── 停止服务.bat            # Windows 停止服务
├── 停止服务.sh             # Linux/Mac 停止服务
├── 启动完整服务.bat        # Windows 启动脚本（显示日志）
├── 启动完整服务.sh         # Linux/Mac 启动脚本（显示日志）
├── README.md               # 说明文档
├── task_plan.md            # 项目规划
├── findings.md             # 研究发现
├── progress.md             # 进度日志
└── 待办事项数据.json       # 数据文件（自动创建）
```

## 数据存储

### 任务数据

应用优先将数据保存到本地文件 `待办事项数据.json` 中，同时使用浏览器的 localStorage 作为备份。

**数据格式：**

```json
{
  "tasks": [
    {
      "id": "1234567890",
      "text": "任务内容",
      "assignee": "子墨",
      "deadline": "2025-01-30",
      "completed": false,
      "createdAt": "2025-01-27T10:00:00.000Z"
    }
  ],
  "webhookUrl": "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=...",
  "version": "1.0",
  "lastSaved": "2025-01-27T10:00:00.000Z"
}
```

### 文件存储

- **主存储**：`待办事项数据.json`（本地文件，通过 File System Access API）
- **备份存储**：浏览器 localStorage（键名：`todoTasks` 和 `wechatWebhook`）

首次使用时，应用会提示您选择或创建数据文件。文件句柄会保存在浏览器的 IndexedDB 中，下次打开应用时会自动恢复。

## 浏览器兼容性

支持所有现代浏览器：
- Chrome/Edge (最新版本，推荐)
- Firefox (最新版本)
- Safari (最新版本)

**注意**：File System Access API 需要 Chrome/Edge 86+ 或 Firefox 111+。如果浏览器不支持，会自动降级到 localStorage 存储。

## 注意事项

### ⚠️ 重要提示

1. **必须使用启动脚本运行**：
   - 企业微信推送功能需要通过代理服务器转发请求
   - 直接打开 HTML 文件无法使用推送功能
   - 必须同时运行代理服务器和前端服务器

2. **数据存储**：
   - 数据优先保存在本地文件 `待办事项数据.json` 中
   - localStorage 作为备份存储
   - 清除浏览器数据不会影响文件中的数据
   - 不同浏览器之间的数据不共享（除非使用相同的文件）

3. **企业微信推送**：
   - 需要网络连接
   - 需要代理服务器运行（端口 3001）
   - Webhook 地址需要是企业微信官方提供的有效地址

4. **端口占用**：
   - 如果端口 3001 或 8000 已被占用，请关闭占用该端口的程序
   - 或修改脚本中的端口号

## 开发说明

本项目使用 planning-with-files 流程进行开发，相关规划文档：
- `task_plan.md`: 任务规划和进度跟踪
- `findings.md`: 技术决策和研究发现
- `progress.md`: 开发进度日志

## 故障排除

### 推送功能无法使用

1. **检查代理服务器是否运行**：
   - 确保 `proxy-server.js` 正在运行
   - 检查控制台是否有错误信息

2. **检查端口是否被占用**：
   - 代理服务器默认使用端口 3001
   - 前端服务器默认使用端口 8000
   - 如果被占用，请关闭占用该端口的程序

3. **检查网络连接**：
   - 确保能够访问企业微信 API
   - 检查防火墙设置

### 数据无法保存

1. **检查浏览器兼容性**：
   - 确保使用支持 File System Access API 的浏览器
   - Chrome/Edge 86+ 或 Firefox 111+

2. **检查文件权限**：
   - 确保应用有权限访问文件系统
   - 首次使用时需要授权

3. **检查控制台错误**：
   - 打开浏览器开发者工具（F12）
   - 查看控制台是否有错误信息
